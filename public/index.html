<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AMU QnA</title>
    <link rel="icon" href="icon.png">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,400italic">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://unpkg.com/vue-material@0.7.1/dist/vue-material.css">
    <script src="https://unpkg.com/vue"></script>
    <script src="https://unpkg.com/vue-material@0.7.1"></script>
    <script src="https://www.gstatic.com/firebasejs/3.9.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.9.0/firebase-database.js"></script>
    <script src="https://unpkg.com/vuefire/dist/vuefire.js"></script>
  </head>
  <body>
    <div id="app">
        <md-whiteframe>
            <md-toolbar>
                <h1 class="md-title">AMU QnA Survey</h1>
            </md-toolbar>
        </md-whiteframe>

        <md-layout md-gutter>
          <md-layout md-flex="20" md-flex-small="10"></md-layout>
          <md-layout md-flex="60" md-flex-small="80">
              <md-card style="margin:16px;">
                  <md-card-header>
                      <div class="md-title">AMU AI Bot</div>
                      <div class="md-subhead">AI bot to solve student queries</div>
                  </md-card-header>

                  <md-card-content>
                      {{ message }}
                      <br><br>Fun Stuff <img style="height: 50px; padding: 5px;" src="https://emojipedia-us.s3.amazonaws.com/cache/0d/4a/0d4a6907a21382c60c80bf93c293926e.png"></img><br>ZHCET Students
                  </md-card-content>
                </md-card>
                <form id="form" v-on:submit.prevent="addQuery">
                    <input type="text" v-model="newQuery.q" placeholder="Query">
                    <input type="text" v-model="newQuery.a" placeholder="Answer">
                    <input type="submit" value="Add User">
                </form>
          </md-layout>
        </md-layout>

        <md-dialog-alert
          :md-content="alert.content"
          :md-ok-text="alert.ok"
          ref="dialog-alert">
        </md-dialog-alert>
    </div>
    <script type="text/javascript">
        var firebaseApp = firebase.initializeApp({
            apiKey: "AIzaSyDs9yK85MAqOxetbqUvbCEjUT9HNSQSGeU",
            authDomain: "amu-qna.firebaseapp.com",
            databaseURL: "https://amu-qna.firebaseio.com",
            projectId: "amu-qna",
            storageBucket: "amu-qna.appspot.com",
            messagingSenderId: "23417801238"
          });
        var db = firebaseApp.database();

        Vue.use(VueMaterial);
        Vue.use(VueFire);

        var queriesRef = db.ref('queries');

        Vue.material.registerTheme('default', {
          primary: 'deep-orange',
          accent: 'purple',
          warn: 'teal',
          background: 'white'
        });

        new Vue({
            el: '#app',
            data: {
                message: 'This site will soon serve as a survey site for registering content from various departments across AMU to make a machine learning data set which will be used to train an AI bot to solve queries.',
                newQuery : {
                    q: '',
                    a: ''
                },
                alert: {
                    content: 'Your query has been added!',
                    ok: 'Cool!'
                }
            },
            methods: {
                openDialog(ref) {
                    this.$refs[ref].open();
                },
                addQuery() {
                    const _vue = this;

                    queriesRef.push(this.newQuery, function(error) {
                        _vue.alert.content = 'Your query has been added!';
                        _vue.alert.ok = 'Cool!';

                        if(error) {
                            _vue.alert.content = 'Error adding query. Service may be down!';
                            _vue.alert.ok = 'Dang!'; 
                        }
                        _vue.openDialog('dialog-alert');
                    });
                    this.newQuery.q = '';
                    this.newQuery.a = '';
                }
            },
            firebase: function() {
                return {
                    messageRef: {
                      source: db.ref('ui/message'),
                      asObject: true,
                      readyCallback: function () {
                        this.message = this.messageRef['.value'];
                      }
                    }
                }
            }
        });
    </script>
  </body>
</html>
